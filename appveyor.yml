version: v{build}
os: Visual Studio 2015
assembly_info:
  patch: false
install:
- set PATH=C:\Program Files (x86)\MSBuild\14.0\Bin;%PATH%
environment:
  TestGenericConnectionString: Server=(local)\SQL2014;Database=TrackerEnabledDbContextTests;User ID=sa;Password=Password12!
  TestIdentityConnectionString: Server=(local)\SQL2014;Database=TrackerEnabledDbContextIdentityTests;User ID=sa;Password=Password12!
services: mssql2014
before_build:
  - cmd: nuget restore
build:  
  verbosity: minimal
  publish_nuget: true

test: off
before_deploy:
  - cmd: nuget pack .\TrackerEnabledDbContext\TrackerEnabledDbContext.csproj -Version %APPVEYOR_REPO_TAG_NAME%
  - cmd: nuget pack .\TrackerEnabledDbContext.Common\TrackerEnabledDbContext.Common.csproj -Version %APPVEYOR_REPO_TAG_NAME%
  - cmd: nuget pack .\TrackerEnabledDbContext.Identity\TrackerEnabledDbContext.Identity.csproj -Version %APPVEYOR_REPO_TAG_NAME%
deploy:
  - cmd: nuget SetApiKey %API_KEY%
  - cmd: nuget push TrackerEnabledDbContext.%APPVEYOR_REPO_TAG_NAME%.nupkg -Source https://api.nuget.org/v3/index.json
  - cmd: nuget push TrackerEnabledDbContext.Common.%APPVEYOR_REPO_TAG_NAME%.nupkg -Source https://api.nuget.org/v3/index.json
  - cmd: nuget push TrackerEnabledDbContext.Identity.%APPVEYOR_REPO_TAG_NAME%.nupkg -Source https://api.nuget.org/v3/index.json
  on:
    APPVEYOR_REPO_TAG: true
